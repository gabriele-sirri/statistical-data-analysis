This assignment requires solving two exercises by writing a C++ macro for ROOT. Alternatively, solutions may use the RooFit libraries in a Python+ROOT script or a Jupyter notebook, though the provided hints are tailored for C++.

Students may choose between using the RooFit Factory or standard RooFit Classes to implement the solution. Teamwork is allowed; however, each student must submit their own work individually.

Exercises on _RooStats_ :

- \[ATLAS.H->4l\]  
    Measurement of the Higgs boson mass in the H→ZZ∗→4l and H→γγ channels with √s=13 TeV pp collisions using the ATLAS detector
- \[CMS- Higgs Discovery 2012\]  
    Observation of a new boson at a mass of 125 GeV with theCMS experiment at the LHC
- \[CMS.jpsi\]  
    J/ψ and ψ(2S) production in pp collisions at √s = 7 TeV


# Hands-on: Systematics, Control regions

Exercises on _Systematics, Control regions_:

- [OPERA-nu oscillations](#exercise-opera-nu-oscillations)
    Discovery of tau neutrino appearance in the CNGS neutrino beam with the OPERA experiment
- [Exercise Composite.LHCb + Simultaneous Fit](#exercise-compositelhcb--simultaneous-fit)  
    First observation of the rare purely baryonic decay B^0→p p

---
---
---

## Exercise: OPERA-nu oscillations  

Discovery of tau neutrino appearance in the CNGS neutrino beam with the OPERA experiment

_Inspired by the analysis described in Phys. Rev. Lett. 115, 121802 (2015), arXiv:1507.01417v2 \[hep-ex\] 2 Nov 2015_

[_https://arxiv.org/pdf/1507.01417.pdf_](https://arxiv.org/pdf/1507.01417.pdf)

The OPERA experiment was designed to search for νμ→ντ oscillations in appearance mode, i.e. by detecting the τ-leptons produced in charged current ντ interactions. The experiment took data from 2008 to 2012 in the CERN Neutrinos to Gran Sasso beam.

The observation of 5 ντ candidate events allow assessing the discovery of νμ→ντ oscillations in appearance mode with a significance larger than 5 σ.

### A number counting analysis with 4 channels and background uncertainties

In this analysis, tau candidates are selected by looking into 4 channels corresponding to 4 different tau decay modes. The observed number of ντ candidates n_i for each individual τ decay channel i is considered as an independent Poisson process with expectation µ\*s_i + β_i .where s_i (constant) and β_i (parameter) are expected signal and background events, respectively; the signal strength µ (parameter) is a continuous multiplicative parameter for the expected signal. The background-only hypothesis corresponds to µ = 0, and the nominal signal to µ = 1.

The likelihood includes Gaussian terms to account for the background uncertainties:

where σ_bi is the background uncertainty for channel i (from Table 3) and β_i are the background parameters Gaussian modelled.

### PART 1 Counting Model in RooFit (one channel) with uncertain background

Just start with a further simplification: consider only one (overall) channel defined as the sum of events neglecting which decay mode they are associated with.

For this part you may take values from the row "Total" of Table 3. They are the observed events (observable), the nominal number of signal events (constant, neglect the error), the expected number of background events (parameter), and the uncertainty of the background events (constant).

- Create a counting model based on Poisson Statistics

Let's suppose we observe **nobs** events when we expect **nexp**, where **nexp = µ s+b** (**µ** is the signal strength, **s** is the nominal number of signal events and **b** is the number of background events. The expected distribution for **nexp** is a Poisson **Poisson(nobs | µ s +b)**.  **µ** is the parameter we want to estimate or set a limit (the parameter of interest), while **b** is the nuisance parameter. The real value of   **b**  is unknown. Its best estimate is "**b0**" with uncertainty **sigmab**. To express this uncertainty we add in the model a Gaussian constraint. We can interpret this term as having an additional measurement **b0** with an uncertainty **sigmab**: i.e. we have a likelihood for that measurement **Gaussian( b0 | b, sigmab)**.

Hints: i) look at the slide "**Counting Model in RooFit (one channel) With Signal Strength"** of the section "RooFit Model for a Number Counting Analysis", then ii) incorporate the gaussian contraint as shown in the slide "EXAMPLE: A simple counting experiment with an uncertain background" of the section "Incorporating systematics"

You may also inspire your code by looking to this example:

<https://twiki.cern.ch/twiki/pub/RooStats/RooStatsExercisesMarch2015/CountingModel.C>

- We generate a hypothetical observed data set. Since we have a counting model, the data set will contain only one event and the observable nobs will have our desired value .

// make data set with the number of observed events; nobs is a RooRealVar

RooDataSet data("data","", nobs);

nobs setVal(5);

data.add(nobs);

- Import the model and the data in a RooFit RooWorkspace and save to file

// import data set in workspace and save it in a file

w.import(model)

w.import(data);

w.writeToFile("CountingModel.root", true);

- Create the **ModelConfig** object and import in the workspace. We need to add in the **ModelConfig** also **b0** as a "global observable". The reason is that **b0** needs to be treated as an auxiliary observable in case of frequentist statistics and varied when tossing pseudo-experiments.

_As b0 is the global observable, b0 needs to have a range_

_However, it is a constant variable (this is needed when we fit the model)._

w.var("b0")->setConstant(true);

To estimate the significance, we need to perform an hypothesis test. We want to disprove the null model, i.e the background only model against the alternate model, the background plus the signal. In RooStats, we do this by defining two ModelConfig objects, one for the null model (the background only model in this case) and one for the alternate model (the signal plus background).

The null hypothesis (i.e. the observed number of events is just a statistical fluctuation of the background only) corresponds to a signal strength mu = 0.

Hints:  
(method 1) see the slides and evaluate the significance using the ProfileLikelihoodCalculator.

(method 2) You may also refer to \$ROOTSYS/tutorials/roostats/StandardHypoTestDemo.C to inspire own code

(method 3, recommended)

You can simply run \$ROOTSYS/tutorials/roostats/StandardHypoTestDemo.C by passing your workspace as argument. Note that in this case it is not necessary to explicitly define a ModelConfig for the null hypothesis, it is automatically computed setting the parameter of interest (signal strength, mu) to zero. Let's use calculator type 2 'Asymptotic calculator' and test type 3 'Profile Likelihood one sided'. The calculator type 0 'Frequentist' is infeasible at this level of significance…!

NOTE - ONLY FOR THIS EXERCISE - that this model is a number counting analysis implemented with an explicit Poisson function, so that from a technical point of view it is not "extended" for RooFit. You must inform the StandardHypoTestDemo(..) function about that by settuing the argument "bool useNC" as a true value)

### 

PART 2 Counting Model in RooFit (4 independent channels) with uncertain backgrounds

Be more realistic and try to repeat the exercise creating a model as the product of 4 independent channels as done in the paper.

For each channel you may define a number observed events (observable), a nominal number of signal events (constant, neglect the error), a expected number of background events (parameter), and a uncertainty of the background events (constant).

Take values from Table 3.

Please, take care that the signal strength is just one for all the channels!

Hints: you may define 4 Poisson PDFs for the signals and 4 Gaussian constraing terms for the background.  
The final model is the product (use RooProduct) of all PDFs.

The RooDataSet still contains only one event and is defined as a set of observables (RooArgSet)

RooDataSet data("obsData","", RooArgSet( obs1, obs2, obs3, obs4 ) );  
obs1 setVal(…);  
obs2.setVal(…);  
…

data.add( RooArgSet( obs1, obs2, obs3, obs4 ) );

- Estimate significance and p-values and check the ones quoted in the paper.

(submit the code)

---
---
---

## Exercise Composite.LHCb + Simultaneous Fit

First observation of the rare purely baryonic decay

Inspired by Figure 1 of: "First observation of the rare purely baryonic decay " arXiv:1709.01156v2 \[hep-ex\] 6 Dec 2017; <https://arxiv.org/abs/1709.01156>

See also <https://cerncourier.com/a/the-rarest-b0-decay-ever-observed/>

**I**n 2017 the LHCb collaboration has observed the rare baryonic decay . The branching fraction was measured at the level of about 1.3 per 100 million decays, which ma kes this decay mode the rarest decay of a B0 meson ever observed. It is also the rarest observed hadronic decay of all beauty mesons.

The search for the rare decays and had previously been performed by LHCb with the full 3  data sample collected during the first run of the LHC. An excess of candidates with respect to the background-only hypothesis is observed with a statistical significance of 5.3 standard deviations. The hint of a  signal reported in 2013 is, however, not confirmed, and an upper limit for the corresponding branching fraction was set. The measured and  branching fractions are compatible with the latest theoretical calculations.

The exercise aims to reproduce the Invariant Mass Distribution of Figure 1

Download **rarest_b0_decay.dat** dataset collected by a B-meson experiment

Load the **unbinned** dataset from the file rarest_b0_decay.dat

Tip: RooDataSet data = \*RooDataSet::read("rarest_b0_decay.dat", x, "v");

Using RooFit, define a (non-extended) composite model for invariant mass.

The model components are:

- a background (suppose exponential with coefficient ranging from -1, -0.000001 );
- a Gaussian peak around the mass
- a Gaussian peak around the mass

Fit the model to the data using a maximum likelihood fit. Plot data and model.

Superimpose each single component with different color

Tip: use the named functions RooFit::Components(…) and RooFit::LineColor(…).

Comment: The plot may not appear as expected. To address this, set reasonable ranges for the signal peaks and assume that and have the same widths (i.e. the same RooRealVar) to simplify the model.

### PART 2: Make histogram of residual and pull distributions

Have a look to <https://root.cern.ch/doc/master/rf109__chi2residpull_8C.html>

Note: methods residHist(…) and pull(..) by default compute the residuals (pulls) of the latest-plotted histogram with respect to the latest-plotted curve.

- Construct a histogram with the residuals of the data w.r.t. the curve
- Construct a histogram with the pulls of the data w.r.t the curve
- Create a new frame to draw the residual distribution and add the distribution to the frame
- Create a new frame to draw the pull distribution and add the distribution to the frame

Visualize the correlation matrix

- - Look at the correlation matrix of the fit.

To make a visual presentation of the correlation matrix, save the RooFitResult object returned by fitTo(..) (don't forget to add RooFit::Save() as argument of fitTo(..))

- Then, add the following code:

TCanvas c;

gStyle->SetPalette(1) ;

fit_results->correlationHist()->Draw("colz") ;

**PART 3: Control Region /simultaneous fit**

Suppose you can measure the background in a CONTROL REGION where the observable ranges from 4000 to 5000 and no signal is present.

Open a new file and copy the model for the physics region and the read the data from the file as in PART1.

Don't perform the fit, don't create a plot.

Define a new observable for the control region which ranges from 4000 to 5000.

Create an exponential model (model_ctl) for the control region. NOTE: the coefficient is shared between the physics and the the control region (…it means that you don't need to define it twice).

Set the coefficient value to -1.0e-3 and generate 10000 events for the control region (data_ctl).

Now you **can follow the RoofiT tutorial 501** (<https://root.cern/doc/master/rf501__simultaneouspdf_8C.html>) to construct a simultaneous fit.

- Define category to distinguish physics and control samples events
- Construct combined dataset in (x,y, sample) where x is the observable in the physic region an y is the observable in the control region.

RooDataSet combData("combData","combined data", RooArgSet(x,y), Index(sample),

Import({{"physics", &data}, {"control", data_ctl}}) );

(warning: Import requires a pointer RooDataSet\*).

- Construct a simultaneous pdf using category sample as index;
- Associate the model of the physics region with the physics state and model_ctl with the control state;
- Perform **simultaneous fit** of model to data and model_ctl to data_ctl
- Make a frame for the physics sample and Plot all data tagged as physics sample.  
    Plot "physics" slice of simultaneous pdf.
- Make a frame for the control sample and Plot all data tagged as control sample  
    Plot "control" slice of simultaneous pdf.
