This assignment requires solving two exercises by writing a C++ macro for ROOT. Alternatively, solutions may use the RooFit libraries in a Python+ROOT script or a Jupyter notebook, though the provided hints are tailored for C++.

Students may choose between using the RooFit Factory or standard RooFit Classes to implement the solution. Teamwork is allowed; however, each student must submit their own work individually.

# Hands-on: ROOSTATS

Exercises on _RooStats_ :

- [ATLAS.H->4l](#exercise-atlash-4l)  
    Measurement of the Higgs boson mass in the H→ZZ∗→4l and H→γγ channels with √s=13 TeV pp collisions using the ATLAS detector
- [CMS- Higgs Discovery 2012](#exercise-cms--higgs-discovery-2012-observation-of-a-new-boson-at-a-mass-of-125-gev-with-thecms-experiment-at-the-lhc) 
    Observation of a new boson at a mass of 125 GeV with theCMS experiment at the LHC
- [CMS.jpsi](#exercise-cmsjpsi-jψ-and-ψ2s-production-in-pp-collisions-at-s--7-tev) 
    J/ψ and ψ(2S) production in pp collisions at √s = 7 TeV

---
---
---

## Exercise ATLAS.H->4l  

Measurement of the Higgs boson mass in the H→ZZ∗→4l and H→γγ channels with √s=13 TeV pp collisions using the ATLAS detector

_Inspired by FIGURE 1(a)_ of Physics Letters B 784(2018)345-366

<https://www.sciencedirect.com/science/article/pii/S0370269318305884>  
_arXiv:1806.00242 \[hep-ex\] 10 Oct 2018_ <https://arxiv.org/abs/1806.00242>

This exercise aims to

- reproduce the plot of Figure 1 (a)
- compute the excess significance in the region of 125 GeV,
- compute significance (p-value) as function of the signal mass
- compute the interval (or an upper limit) to the Higgs mass with Profile Likelihood and Feldman.Cousin using RooFit and RooStats.

### PART 1. MODEL, FIT, PLOT

Please download the text file higgs_4l.dat with 123 events.

Events have been selected given the presence of 4 leptons with invariant mass in the 110-135 GeV range. Each line corresponds to one single event. The observable is the invariant mass of the 4-leptons system.

- define the observable as a RooRealVar

RooRealVar x{"x","invariant mass", 110, 135, "GeV"};

- set the number of bins according to the Figure 1 (a)
- import the dataset as RooFit unbinned dataset (RooDataSet)

Hints: use ASCII import/export for datasets RooDataSet::read(…)

as in \$ROOTSYS/tutorials/roofit/rf102_dataimport.C

- define a model for the invariant mass distribution.

The p.d.f. has two components:

- a Higgs signal model called smodel: H → 4l peak
- a background model called bmodel: modelled by a polynomial function of degree 2;

The Higgs signal model is a complex model derived from a Breit-Wigner distribution with width = 4.1 GeV.

For this exercise we use instead a Crystal Ball (CB) shape distribution implemented by the RooCBshape class. There are several constraints to be taken into account to define the parameters

- Higgs mass (the mean of CB) ranges is \[110, 150\],
- Higgs width (the width of CB) is 4.1/2.35 (constant),
- alpha is 0.6 (constant)
- the power-law's exponent n is 20 (constant)

The Background model is a polynomial PDF of degree 2 implemented by RooPolynomial. Given that the polynomial is normalized to 1 (automatically by RooFit), you must provide just 2 independent parameters.

RooRealVar a1("a1", "The a1 of background", -160, -100, -200);

RooRealVar a2("a2", "The a2 of background", 2.7, 2, 4);

More realistic constraints are described in the paper, but we can neglect it.

Define the expected yields for the different components of the spectrum (nsignal, nbackground).

With the Extended Likelihood Formalism build an Extended Composite Model called model by using RooAddPdf (or the RooFit factory as well).

- Fit the model to the data using a maximum likelihood fit.
- Plot data and model.
- Import dataset and model (and automatically all related elements) into a RooWorkspace.

Create a Model Config "ModelConfig" for the signal plus background model. Use the Higgs signal yield as the parameter of interest, the floating parameters are nuisance, and ensure constants are explicitily set as constant.

This model configuration must be used for:

- the Significance vs Mass plot
- hypothesis test (StandardHypoTestDemo)

Hint: how to set constantness for constant parameter:

w.var("width")->setConstant(true);

w.var("alpha")->setConstant(true);

w.var("n")->setConstant(true);

Hint: How to define a Model Config:

<https://twiki.cern.ch/twiki/bin/view/RooStats/RooStatsExercisesMarch2015#Exercise_1_Create_a_ModelConfig>

RooStats::ModelConfig mc("ModelConfig", &w);

mc.SetPdf(...

mc.SetParametersOfInterest(...

mc.SetObservables(...

// define set of nuisance parameters

w.defineSet("nuisParams","nbackground,a1,a2");

mc.SetNuisanceParameters(\*w.set("nuisParams"));  
mc.SetSnapshot(nsignal);

\- IMPORTANT AND ONLY FOR THIS: set also the mass as a constant, required for the significance vs mass plot.

// mass.setConstant(true); // this doesn't work, use the following..

w.var("mass")->setConstant(true);

- Import the ModelConfig "ModelConfig" into the workspace

Define another Model Config "ModelConfig_mass" where

- - the parameter of interest is the HIGGS MASS
    - the set of nuisance parameters is nuisParams2 which includes the signal yield nsignal

w.defineSet("nuisParams2", "nbackground,a1,a2,nsignal,width");

This model configuration must be used for

- Higgs mass interval with profile likelihood (StandardProfileLikelihoodDemo)
- Higgs mass interval with Feldman Cousin (StandardFeldmanCousinsDemo)
- Import the ModelConfig "ModelConfig_mass" into the workspace
- Save the workspace to a file

### PART 2. Higgs mass Profile Likelihood interval

- Compute a 68% C.L. interval on the **Higgs mass**, using RooStats Profile Likelihood Calculator.
- Plot the likelihood interval and adjust the range by hand (right click on axis and setrangeuser).  
    x from 120 to 128, y from 0 to 20
- Try to change the confidence level.

Hints: Look at the code in the slides. You may refer to \$ROOTSYS/tutorials/roostats/ StandardProfileLikelihoodDemo.C to guide your work or you can just run StandardProfileLikelihoodDemo.C by passing your workspace as argument (recommended).

### PART 3. Higgs mass Feldman Cousin interval

- Compute a 90% C.L interval on the **Higgs mass**, using RooStats Feldman Cousin Calculator.
- Try to change the confidence level.

Hint: You may refer to \$ROOTSYS/tutorials/roostats/StandardFeldmanCousinsDemo.C to guide your work or you can just run StandardFeldmanCousinsDemo.C with your workspace as argument (recommended).

### PART 4. Compute the significance (Hypothesis Test)

To estimate significance, we perform a hypothesis test to reject the null (background-only) model in favor of the alternate (signal-plus-background) model. In RooStats, this involves defining two ModelConfig objects: one for the null and one for the alternate model.

The null hypothesis (i.e. the peak in the data is just a statistical fluctuation of the background only) corresponds to a Higgs signal yield nsignal = 0.

Hints:  
(method 1) see the slides and evaluate the significance using the ProfileLikelihoodCalculator.

(method 2) refer to \$ROOTSYS/tutorials/roostats/StandardHypoTestDemo.C to guide your work

(method 3, recommended) Run the script \$ROOTSYS/tutorials/roostats/StandardHypoTestDemo.C with your workspace as the argument. You don't need to manually define a ModelConfig for the null hypothesis-it's automatically set by assigning the parameter of interest (signal strength, μ) to zero. Use **Calculator Type 2** ("Asymptotic Calculator") and **Test Type 3** ("Profile Likelihood One-Sided"). Avoid **Calculator Type 0** ("Frequentist"), as it's impractical for this level of significance.

### PART 5. Compute significance (p-value) as function of the signal mass

As an optional exercise in RooStats, we'll explore how significance (or p-value) varies with the signal mass hypothesis in a Gaussian signal plus exponential background model

Using the AsymptoticCalculator, we'll test several mass points, plot the p-value for the null hypothesis (p0), and estimate the expected significance as a function of mass. The expected significance can be calculated with AsymptoticCalculator::GetExpectedPValues, using observed p-values for the null and alternate models. Refer to the Asymptotic formulae paper for details.

Hints: you can follow the solution described in Exercise 6b from

<https://twiki.cern.ch/twiki/bin/view/RooStats/RooStatsExercisesMarch2015#Exercise_6b_Compute_significance>

It is worth mentioning here that Higgs signal mass means the mean of the Crystal Ball distribution! Not the observable!

(submit the source code, the plots and all relevant information you got)

---
---
---

## Exercise CMS- Higgs Discovery 2012, Observation of a new boson at a mass of 125 GeV with theCMS experiment at the LHC

Inspired by Figure 4 "Distribution of the four-lepton invariant mass" of "Observation of a new boson at a mass of 125 GeV with the CMS experiment at the LHC" arXiv:1207.7235v2 \[hep-ex\] 28 Jan 2013

<https://arxiv.org/abs/1207.7235> , <https://inspirehep.net/literature/1124338>

Root files have been processed from the [Higgs analysis example on the CMS 2011-2012 Open Data](http://opendata-dev.web.cern.ch/record/5501) .

Data source was <https://github.com/cms-opendata-analyses/HiggsExample20112012>.

In 2012, the Compact Muon Solenoid (CMS) experiment at the LHC presented results from searches for the standard model Higgs boson in proton-proton collisions at sqrt(s) = 7 and 8 TeV. The search is performed in five decay modes: gamma gamma, ZZ, WW, tau tau, and b b-bar. An excess of events is observed above the expected background at a mass near 125 GeV, signalling the production of a new particle compatible with standard model Higgs boson.

This exercise aims to reproduce the Figure 4 representing the H → ZZ → 4 leptons decay mode

### PART 1 - COMPOSITE MODEL

Define the four lepton invariant mass distribution as an observable. Set the range, binning and units as in the final plot-

Download:

\_cms_higgs_data.txt real data

\_cms_higgs_TTbarto4l.txt top contribution (scaled to the MC generator cross section).

\_cms_higgs_DYto4l.txt Drell Yan (Z/\*) contribution (scaled to the Z peak)

\_cms_higgs_ZZto4l.txt ZZ contribution

(scaled to describe the data in the independent mass range 180-600 GeV

~~\_cms_higgs_HZZto4l.txt Higgs to ZZ to 4 leptons contribution~~

All files contain binned data. The file format is \[BIN-CENTER\] \[BIN WEIGHT\].

The Background histograms are already scaled to the final distribution

The first (last) record is an underflow (overflow) bin and is outside the observable range. They should not be included.

Now, we want to build a composite model using the histograms stored in the files.

The final model is like:

model(x) = f_s \* sign(x) + (1 - f_s) \* bkg(x)

where

- - - f_s the fraction of signal
      - sign (x) the H → ZZ → 4 leptons distribution
      - bkg(x) the sum of background components to 4leptons from

The **background** is a sum of 3 components ttbar, DY and ZZ, and their distribution are stored in files.

Read all the **binned** dataset and fill a RooDataHist for each file:

Example code:

RooDataHist data{"data", "data", x};

ifstream file("filename.txt");

double val, weight;

while (!file.eof()) {

file >> val >> weight;

x.setVal(val);

data.set(x weight); // (\*)

}

Then, create a P.D.F. for each background component:

Hint: have a look to RooHistPdf in <https://root.cern/doc/master/rf706__histpdf_8C_source.html>

Build a composite model for the background only, such as

bkg(x) = f_ttbar \* ttbar(x) + f_drly \* drly(x) + (1- f_ttbar.- f_drly) \* zz(x)

We want the fractions of the 3 background components to be fixed relative to one another.

Given that the input histograms are already scaled from the input files, f_ttbar and f_drly shall be set proportional to the relative weight of their RooDataHist integrals over the observable range.

Hint: use the method sum(kTRUE) of RooDataHist to get the integral over the observable range.

As approximation set a **signal** pdf using a Guassian distribution.

Let only the mean (mass of Higgs) be a floating parameter and fix the width to 3 GeV.

Fit the model to the data. Only f_s and the mass of the Higgs are floating parameters.

Save the fit results to an object RooFitResults.

Plot the data and the fitted model.

Plot also the signal component in red and the total bkg component in black.

Write the best fit parameters on the plot too. (hint: paramOn(…) method of RooAbsPdf).

### PART 2: use a RooStats ProfileLikelihoodCalculator for a confidence interval  

Compute the 95% confidence interval for Higgs mass

The calculator considers systematics by eliminating nuisance parameters with the profile likelihood. This is equivalent to the method of MINOS (the algorithm of MINUIT!).

Specify components of model for statistical tools

Hint: create a model for statistical tools (ModelConfig), a model config must be defined inside a RooWorkspace

RooWorkspace w;

RooStats::ModelConfig mc("model_config", &w);

Set the model, the observable, the Higgs mass as Parameter of Interest and f_s as nuisance parameter.

Compute the 95% confidence interval for Higgs mass with a Profile Likelihood Calculator.

Plot the interval.

Hints: Look at the code in the slides. You may refer to \$ROOTSYS/tutorials/roostats/ StandardProfileLikelihoodDemo.C to guide your work or you can just run StandardProfileLikelihoodDemo.C by passing your workspace as argument (recommended).

### PART 3. Higgs mass Feldman Cousin interval

- Compute a 90% C.L interval on the **Higgs mass**, using RooStats Feldman Cousin Calculator.
- Try to change the confidence level.

Hint: You may refer to \$ROOTSYS/tutorials/roostats/StandardFeldmanCousinsDemo.C to guide your work or you can just run StandardFeldmanCousinsDemo.C with your workspace as argument (recommended).

### PART 4: use a RooStats ProfileLikelihoodCalculator for a Hypothesis test  

Compute the p-value and its corresponding significance for Higgs discovery

The variable fraction of signal (f_s) is somehow the **signal strength** in this composite model.

To establish a discovery one tries to reject the background only hypothesis corresponding to f_s = 0.

~~Change the model config and set f_s as Parameter of Interest and the Higgs mass as nuisance parameter.~~

Compute Significance and P-VALUE.

_The null hypothesis (i.e. the signal peak is a statistical fluctuation of the flat background)  
corresponds to f_s = 0, i.e. a null value for the parameter of interest._

Hints:  
(method 1) see the slides and evaluate the significance using the ProfileLikelihoodCalculator.

(method 2) refer to \$ROOTSYS/tutorials/roostats/StandardHypoTestDemo.C to guide your work

(method 3, recommended) Run the script \$ROOTSYS/tutorials/roostats/StandardHypoTestDemo.C with your workspace as the argument. You don't need to manually define a ModelConfig for the null hypothesis-it's automatically set by assigning the parameter of interest (signal strength, μ) to zero. Use **Calculator Type 2** ("Asymptotic Calculator") and **Test Type 3** ("Profile Likelihood One-Sided"). Avoid **Calculator Type 0** ("Frequentist"), as it's impractical for this level of significance.

### PART 5. Compute significance (p-value) as function of the signal mass

As an optional exercise in RooStats, we'll explore how significance (or p-value) varies with the signal mass hypothesis in a Gaussian signal plus exponential background model

Using the AsymptoticCalculator, we'll test several mass points, plot the p-value for the null hypothesis (p0), and estimate the expected significance as a function of mass. The expected significance can be calculated with AsymptoticCalculator::GetExpectedPValues, using observed p-values for the null and alternate models. Refer to the Asymptotic formulae paper for details.

Hints: you can follow the solution described in Exercise 6b from

<https://twiki.cern.ch/twiki/bin/view/RooStats/RooStatsExercisesMarch2015#Exercise_6b_Compute_significance>

It is worth mentioning here that Higgs signal mass means the mean of the Gaussian distribution! Not the observable!

(submit source code, plots, and results as text file )

---
---
---

## Exercise CMS.jpsi J/ψ and ψ(2S) production in pp collisions at √s = 7 TeV

_Inspired by JHEP02(2012)011_

[https://link.springer.com/content/pdf/10.1007/JHEP02(2012)011.pdf](https://link.springer.com/content/pdf/10.1007/JHEP02%282012%29011.pdf)_arXiv:1111.1557v1 \[hep-ex\] 7 Nov 2011_ <https://arxiv.org/abs/1111.1557>

This exercise aims to reproduce the plot of Figure 1 (bottom) and then compute the excess significance in the region of 3.65 GeV, compute the interval (or an upper limit) to the ψ(2S) signal yield , calculate the significance using RooFit and RooStats.

### PART 1. MODEL, FIT, PLOT

Download MuRun2010B.csv

This file, sourced from the [CERN Open Data Portal](http://opendata.cern.ch/record/700), contains 100k dimuon events selected from the CMS Mu dataset (Run2010B) <http://opendata.cern.ch/record/700> .

Events include exactly two muons with an invariant mass between 2-110 GeV. Each line represents an event, with the format detailed in the first line:

Run,Event,Type1,E1,px1,py1,pz1,pt1,eta1,phi1,Q1,Type2,E2,px2,py2,pz2,pt2,eta2,phi2,Q2,M

The observable is the invariant mass of the dimuon system, derived from other columns already present in the CSV file. Calculate the invariant mass for each event outside RooFit, then import the dataset as an unbinned RooDataSet in RooFit. Only include events where the rapidity (η) of both muons is less than 1.2

The following steps may be time-consuming depending on your laptop performance. In case of problems or if you simply prefer to be faster during the code prototyping, let's consider working with a subsample of data in order not to have a too high significance of your signal yield, which will then be difficult to estimate if we use pseudo-experiments

Hints:  
You can find your own way or exploit RDataFrame, a modern C++ high-level interface for interacting with data in ROOT v6.18+. With RDataFrame a smallest dataset can be generated by calling RDataFrame::Range( … ) .

int create_dataset()

{

&nbsp; auto tdf = ROOT::RDF::MakeCsvDataFrame("MuRun2010B.csv");

&nbsp; tdf.Filter("eta1 < 1.2 && eta2 < 1.2")

&nbsp;     .Define("mass",

&nbsp;             "sqrt(pow(E1 + E2, 2) - (pow(px1 + px2, 2) + pow(py1 + py2, 2) + "

&nbsp;             "pow(pz1 + pz2, 2)))")

&nbsp;     .Range(0, 0, 3)

&nbsp;     .Snapshot("tree", "my_muons.root");

&nbsp; return 1;

}

Now the filtered data with the additional column "mass" are available in a TTree stored in my_muons.root.

First, you may define the observable as a RooRealVar

&nbsp; RooRealVar mass{"mass", "#mu^{+}#mu^{-} invariant mass", 2., 6., "GeV"};

And then import the TTree (which is an unbinned dataset) to a RooDataSet.

&nbsp; auto f = TFile::Open("my_muons.root");

&nbsp; auto tree = static_cast&lt;TTree\*&gt;(f->Get("tree"));

&nbsp; RooDataSet dataset("dataset", "dataset", RooArgSet(mass),

&nbsp;                    RooFit::Import(\*tree));

&nbsp; dataset.Print();

Now, you must define a model for the invariant mass distribution. The p.d.f. has several components, as described in the section 4 "Inclusive yield determination" of the paper. They can be simplified as:

- J/ψ → μμ peak, a Crystal Ball distribution
- ψ(2S) → μμ peak, a Crystal Ball distribution
- background, modelled by two exponentials.

Crystal Ball shape distribution is implemented by the RooCBshape class.

There are several constraints to be taken into account when you define the parameters:

- for J/ψ Crystal Ball: mean ranges from \[2.7, 3.3\], width from \[0.00001,1.\], alpha from \[-10, 10\] and the power-law's exponent n from \[0.2, 10\]
- for ψ(2S) Crystal Ball: mean ranges from \[3.3, 3.9\], while width, alpha and n are the same as J/ψ peak.
- No constraints exist for the exponential distributions.

More realistic constraints are described in the paper, but we can neglect them.

Define the expected yields for the different components of the spectrum (njpsi, npsi2s, njpsi, njpsi).

With the Extended Likelihood Formalism build an Extended Composite Model by using RooAddPdf or the factory.

Fit the model to the data using a maximum likelihood fit.

Plot data and model.

Import dataset and model (automatically all related elements) into a workspace.

Define the Model Config for the signal_plus_background using the ψ(2S) signal yield as parameter of interest, the remaining floating parameters are nuisance.

Hints: (w is the workspace)

RooStats::ModelConfig mc("sig_plus_bkg", &w);

mc.SetPdf(...

mc.SetParametersOfInterest(...

mc.SetObservables(...

// define set of nuisance parameters

w.defineSet("nuisance_params",

"NJpsi,Nbkg,a1,a2,a3,alphaJpsi,meanJpsi,meanpsi2S,nJpsi,sigmaJpsi");

mc.SetNuisanceParameters(\*w.set("nuisance_params"));  
mc.SetSnapshot(Npsi);

Import the ModelConfig into a workspace and save it to a file.

### PART 2. ψ(2S) signal yield interval

Compute a 95% interval on the **ψ(2S) signal yield**, using RooStats Profile Likelihood Calculator.

Hints: Look at the code in the slides. You may refer to \$ROOTSYS/tutorials/roostats/ StandardProfileLikelihoodDemo.C to guide your work or you can just run StandardProfileLikelihoodDemo.C by passing your workspace as argument (recommended).

### PART 3. Compute the significance (Hypothesis Test)

To estimate significance, we perform a hypothesis test to reject the null (background-only) model in favor of the alternate (signal-plus-background) model. In RooStats, this involves defining two ModelConfig objects: one for the null and one for the alternate model.

The null hypothesis _(i.e. the_ ψ(2S) _peak would be a statistical fluctuation of the background_) _corresponds to a_ ψ(2S) signal yield npsi2s _= 0._

Hints:  
(method 1) see the slides and evaluate the significance using the ProfileLikelihoodCalculator.

(method 2) refer to \$ROOTSYS/tutorials/roostats/StandardHypoTestDemo.C to guide your work

(method 3, recommended) Run the script \$ROOTSYS/tutorials/roostats/StandardHypoTestDemo.C with your workspace as the argument. You don't need to manually define a ModelConfig for the null hypothesis-it's automatically set by assigning the parameter of interest (signal strength, μ) to zero. Use **Calculator Type 2** ("Asymptotic Calculator") and **Test Type 3** ("Profile Likelihood One-Sided"). Avoid **Calculator Type 0** ("Frequentist"), as it's impractical for this level of significance.

### PART 4. Compute significance (p-value) as function of the signal mass

As an optional exercise in RooStats, we'll explore how significance (or p-value) varies with the signal mass hypothesis in a Gaussian signal plus exponential background model

Using the AsymptoticCalculator, we'll test several mass points, plot the p-value for the null hypothesis (p0), and estimate the expected significance as a function of mass. The expected significance can be calculated with AsymptoticCalculator::GetExpectedPValues, using observed p-values for the null and alternate models. Refer to the Asymptotic formulae paper for details..

Hints: to run this part in RooStats you have explicitly define the ModelConfig object for background only model:

auto mcb = mc.Clone();

mcb->SetName("bkg_only");

Npsi.setVal(0);

mcb->SetSnapshot(Npsi);

w.import(\*mcb);

import the background-only model config object to the workspace and save it to file.

Hints: you can follow the solution described in Exercise 6b from

<https://twiki.cern.ch/twiki/bin/view/RooStats/RooStatsExercisesMarch2015#Exercise_6b_Compute_significance>

It is worth mentioning here that signal mass means the mean of ψ(2S) Crystal Ball distribution!  
Not the observable!

(submit source code, plots, and results as text file )
